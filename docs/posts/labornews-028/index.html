<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="박영삼">
<meta name="dcterms.date" content="2025-03-14">

<title>고소득층 소득비중 줄었지만 분배개선 불투명 – park youngsam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">park youngsam</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">News | Column</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://facebook.com"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="http://yspark1968.blogspot.com/"> 
<span class="menu-text">Blogger</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">고소득층 소득비중 줄었지만 분배개선 불투명</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">국세통계</div>
                <div class="quarto-category">통합소득</div>
                <div class="quarto-category">상위10%</div>
                <div class="quarto-category">개인소득</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>박영삼 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 14, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#국세청-통합소득-천분위-분석-결과-상위-1-소득-감소로-소득집중도-하락" id="toc-국세청-통합소득-천분위-분석-결과-상위-1-소득-감소로-소득집중도-하락" class="nav-link active" data-scroll-target="#국세청-통합소득-천분위-분석-결과-상위-1-소득-감소로-소득집중도-하락">국세청 통합소득 천분위 분석 결과 … 상위 1% 소득 감소로 소득집중도 하락</a>
  <ul class="collapse">
  <li><a href="#상위-1상위-10-소득비중-각각-11.637.2" id="toc-상위-1상위-10-소득비중-각각-11.637.2" class="nav-link" data-scroll-target="#상위-1상위-10-소득비중-각각-11.637.2">상위 1%·상위 10% 소득비중 각각 11.6%·37.2%</a></li>
  <li><a href="#가계배분-배당금-규모와-비중-소득집중도에-영향-커" id="toc-가계배분-배당금-규모와-비중-소득집중도에-영향-커" class="nav-link" data-scroll-target="#가계배분-배당금-규모와-비중-소득집중도에-영향-커">가계배분 배당금 규모와 비중, 소득집중도에 영향 커</a></li>
  <li><a href="#인당-소득세-처음으로-감소-소득-높을수록-감소폭-커" id="toc-인당-소득세-처음으로-감소-소득-높을수록-감소폭-커" class="nav-link" data-scroll-target="#인당-소득세-처음으로-감소-소득-높을수록-감소폭-커">1인당 소득세 처음으로 감소, 소득 높을수록 감소폭 커</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="박영삼의-통계로-보는-노동" class="level4">
<h4 class="anchored" data-anchor-id="박영삼의-통계로-보는-노동">박영삼의 통계로 보는 노동</h4>
</section>
<section id="국세청-통합소득-천분위-분석-결과-상위-1-소득-감소로-소득집중도-하락" class="level2">
<h2 class="anchored" data-anchor-id="국세청-통합소득-천분위-분석-결과-상위-1-소득-감소로-소득집중도-하락">국세청 통합소득 천분위 분석 결과 … 상위 1% 소득 감소로 소득집중도 하락</h2>
<p>2023년 귀속분 소득에 대한 국세청 소득천분위 자료들이 국회에 제출되고 있다. 소득천분위 자료는 근로소득 연말정산 인원과 종합소득 신고자를 인별로 합산해 소득순으로 백분위를 구분한 다음 최상위 1%를 다시 0.1% 구간으로 세분해 집계한 것을 말한다.</p>
<section id="상위-1상위-10-소득비중-각각-11.637.2" class="level3">
<h3 class="anchored" data-anchor-id="상위-1상위-10-소득비중-각각-11.637.2">상위 1%·상위 10% 소득비중 각각 11.6%·37.2%</h3>
<p>국세청이 더불어민주당 윤건영 의원실에 제출한 2023년 귀속본 근로소득·종합소득·통합소득 천분위 자료를 분석해본 결과, 고소득층이 전체 소득에서 차지하는 비중이 2022년에 이어 2023년에도 감소하는 등 개인분배지표가 개선된 것으로 나타났으나, 2024년부터 시작된 배당금 증가 현상과 감세 영향 등으로 앞으로는 추가 개선이 어려울 것으로 예상됐다.</p>
<p>우선 통합소득 최상위 0.1%(평균소득 17억3천681만원, 소득경계값은 2억249만원) 계층의 소득이 전체 소득에서 차지하는 비중은 4.2%로, 2022년의 4.5%에 비해 0.3%포인트 감소했다. 상위 1%(평균소득 4억7천619만원, 경계값 2억249만원)의 소득비중도 11.9%에서 11.6%로, 상위 10%(평균 1억5천317만원, 경계값 8천402만원)의 소득비중은 37.6%에서 37.2%로 각각 ?0.3%포인트, 0.4%포인트 하락했다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tincome1.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>통합소득 5분위배율과 10분위배율은 각각 25.6배에서 25.3배로, 71.2배에서 69.8배로 격차가 줄었으며, 상위 10%와 하위 40%의 소득배율을 뜻하는 팔마배율도 8.76배에서 7.94배로 개선된 것으로 나타났다. 하지만 코로나19 사태가 발생했던 2020년 수준 정도이고 가장 양호한 소득분배 지표를 보였던 2018~2019년 시기 수준을 회복하는 정도에는 한참 못 미친다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tincome2.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>지난해 말 결과가 발표된 통계청의 가계금융복지조사에서 2023년 말 기준 소득분배지표가 2년 연속 개선되고 있는 데 대해, 최상위 고소득층 표본이 누락될 가능성이 높다는 점을 들어 국세청 천분위 자료를 확인할 필요가 있었는데, 초고소득층까지 포괄하는 국세청 소득통계에서도 비록 개인단위 소득이긴 하지만 분배지표가 개선되고 있다는 것이 재확인된 것이다.</p>
</section>
<section id="가계배분-배당금-규모와-비중-소득집중도에-영향-커" class="level3">
<h3 class="anchored" data-anchor-id="가계배분-배당금-규모와-비중-소득집중도에-영향-커">가계배분 배당금 규모와 비중, 소득집중도에 영향 커</h3>
<p>하지만 몇 가지 요인을 들여다보면 이같은 추세가 앞으로도 지속될 것으로 예상하기는 어렵지 않나 생각된다. 초고소득층의 경우 재벌대기업 총수나 고위임원, 그리고 대형사업을 운영하는 사업소득자들이 대부분인데 한국은행 가계분배계정 통계를 보면 이들의 주된 소득원천인 사업소득과 임원보수, 스톡옵션, 배당금 등이 감소하거나 정체했던 사실을 확인할 수 있다. 2023년 통합소득 최상위 0.1%의 총소득이 46.7조원으로 2022년의 47.1조에 비해 0.9% 감소하는 일이 처음으로 발생했고 2022년에도 이들의 총소득 증가율은 0.5%에 그쳤다. 가계분배계정을 확인해보면 큰 규모의 사업소득이 발생하는 준법인기업 소득인출액이 2020년 이후 3년 연속 감소했고, 2021년에 37.1조에 달했던 가계로 지급된 배당금 총액이 2022년에는 33.8조원으로 2013년 이후 처음으로 감소한데 이어 2023년에도 34조원 규모로 0.6% 증가에 그쳐, 2013년 이후 가장 낮은 증가율을 기록했다.</p>
<p>최근 수년간 가계로 분배되는 배당금 비중이 증가하면 국세청의 상위 1% 소득 점유비중이 증가하고, 반대로 배당금 비중이 하락하면 상위 1%의 소득비중도 하락하는 동조현상을 보이고 있다. 배당금은 전체 국민총소득에서 차지하는 비중이나 절대규모는 크지 않지만 개인과 가계에 배분되는 소득으로는 적지 않은 규모이며 최상위 소득층에게 집중 배분되고 그것이 최상위층의 주된 소득원이 된다는 점에서 전체적인 소득분배에 연쇄적으로 영향을 미치게 된다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tincome3.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>그런데 주춤했던 배당금 증가세는 지난해부터 이미 반전 조짐이 나타나고 있다. 2024년 국내 상장사들의 배당금 총액은 31조원으로 2023년의 28조원에 비해 10% 이상 증가한 것으로 확인되고 있다. 이재용 삼성전자 회장이 3천465억원을 배당받아 1위를 기록했는데 상위 30위 안에 든 대주주들의 배당총액이 17.8조원으로 전체 배당금의 60% 가까이 차지한다. 이러한 배당금의 증가는 결국 개인소득 분배에서 최상위층의 점유비중을 다시 증가시키는 요인으로 작용할 수 있다.</p>
</section>
<section id="인당-소득세-처음으로-감소-소득-높을수록-감소폭-커" class="level3">
<h3 class="anchored" data-anchor-id="인당-소득세-처음으로-감소-소득-높을수록-감소폭-커">1인당 소득세 처음으로 감소, 소득 높을수록 감소폭 커</h3>
<p>이와 함께 2021년 이전까지 소득세 최고세율 인상 등의 영향으로 조세에 의한 소득분배 개선 효과가 커졌는데 최근 들어 반대 방향의 움직임이 확인되고 있다. 상위 10%의 소득점유 비중이 2021년 37.8%에서 2023년 37.1%로 하락했지만 2019년의 36.6%에 비해서는 여전히 높은 수준에 있지만, 상위 10%의 소득세 점유비중은 2014년 80.2%로 정점을 기록한 뒤 추세적으로 하락하면서 2023년에는 77.0%로 역대 최저치를 나타내고 있다.</p>
<p>더구나 2023년에 와서 고소득층일수록 소득세 감소율이 높아지는 역진적인 현상이 나타나고 있다. 2023년 최상위 0.1%의 소득은 -3.3% 감소했는데 소득세 감소율은 -4.8%에 이른다. 상위 1%의 소득감소율은 -0.7%인데 소득세 감소율은 -2.4%에 이른다. 상위 10%와 상위 20%의 경우 소득은 각각 1.3%, 1.9%로 플러스 증가를 기록했는데 소득세는 각각 ?1.6%, -1.5% 감소한 것으로 나타났다. 하위 50%만 유일하게 소득증가율 3.3%보다 훨씬 높은 6.5%의 소득세 증가율을 보였다. 이것은 앞으로 조세의 소득분배 개선 효과가 약화될 수 있다는 것을 의미한다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tincome4.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>윤석열 정부는 출범 이후 법인세, 소득세 감세를 추진해 왔다. 그 혜택은 기업을 거쳐 초고소득층에 소득을 더 집중시키고, 조세의 분배개선 효과를 감소시키며, 나아가 복지에 지출할 수 있는 재정여력까지 훼손할 위험성이 매우 크다.</p>
<p>고려대 노동문제연구소 노동데이터센터장 (<a href="youngsampk@gmail.com">youngsampk@gmail.com</a>)</p>


</section>
</section>

</main> <!-- /main -->
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-60S2W83K5X');

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>